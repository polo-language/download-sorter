apply plugin: 'java'
apply plugin: 'jacoco'

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.12'
}

final String testDirName = 'test'
final String testOriginalsDirName = 'originals'
final String testTempDirName = "tmp-test"
final String inRootPath = "$buildDir/$testTempDirName/in"
final String outRootPath = "$buildDir/$testTempDirName/out"
final String singleRunPath = "$inRootPath/singlerun"
final String watchRegexPath = "$inRootPath/watchregex"
final String watchGlobPath = "$inRootPath/watchglob"

task testPrepDuplicateInputs() {
    doFirst {
        delete(file("$buildDir/$testTempDirName"))
        file("$buildDir/$testTempDirName").mkdir()
        file(inRootPath).mkdir()
        file(outRootPath).mkdir()
    }

    doLast {
        copy {
            from "$testDirName/$testOriginalsDirName"
            into singleRunPath
        }

        copy {
            from "$testDirName/$testOriginalsDirName"
            into watchRegexPath
        }

        copy {
            from "$testDirName/$testOriginalsDirName"
            into watchGlobPath
        }
    }
}

test {
    dependsOn {
        testPrepDuplicateInputs
    }

    systemProperty "TEST_OUT_PATH", outRootPath
    systemProperty "SINGLERUN_PATH", singleRunPath
    systemProperty "WATCH_REGEX_PATH", watchRegexPath
    systemProperty "WATCH_GLOB_PATH", watchGlobPath
}
