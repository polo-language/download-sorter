apply plugin: 'java'
apply plugin: 'jacoco'

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.12'
}

final String testDirName = 'test'
final String testOriginalsDirName = 'originals'
final String testTempDirName = "tmp-test"
final String inRootPath = "$buildDir/$testTempDirName/in"
final String outRootPath = "$buildDir/$testTempDirName/out"
final String singleRunPath = "$inRootPath/singlerun"

task testPrepCleanup(type: Delete) {
    delete fileTree(dir: "$buildDir/$testTempDirName", include: '*')
}

task testPrepDuplicateInputs(type: Copy) {
    from "$testDirName/$testOriginalsDirName"
    into singleRunPath
}

task testPrepCreateOutDir {
    file(outRootPath).mkdir()
}

test {
    dependsOn {
        testPrepCleanup
        testPrepCreateOutDir
        testPrepDuplicateInputs
    }

    systemProperty "TEST_OUT_PATH", outRootPath
    systemProperty "SINGLERUN_PATH", singleRunPath
}
